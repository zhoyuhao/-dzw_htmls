<!DOCTYPE html>
<html class="x-admin-sm">

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<title>欢迎页面-X-admin2.2</title>
		<link rel="stylesheet" href="../css/index.css" />
		<script type="text/javascript" src="../js/vue.js"></script>
		<script type="text/javascript" src="../js/jquery-1.12.4.js"></script>
		<script type="text/javascript" src="../js/jq_ajax_config.js"></script>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="stylesheet" href="../css/font.css">
		<link rel="stylesheet" href="../css/xadmin.css">
		<script src="../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../js/xadmin.js"></script>
	</head>

	<body>
		<div class="x-nav">
			<span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
			</a>
		</div>
		<div class="layui-row layui-col-space15" id="legworkApp">
			<div class="layui-col-md12">
				<div class="layui-card">
					<template>
						<el-tabs v-model="activeName" type="card" @tab-click="handleClick">
							<el-tab-pane label="未出车" name="未出车">
								<div class="layui-card-header">
									<button class="layui-btn" onclick="xadmin.open('添加外勤车辆','外勤车辆管理添加.html',800,600)">
                                <i class="layui-icon"></i>添加</button></div>
								<template>
									<el-table :data="this.page.list" style="width: 100%">
										<el-table-column label="车辆编号" prop="legworkid">
										</el-table-column>
										<el-table-column label="车牌号" prop="platenumber">
										</el-table-column>
										<el-table-column label="品牌" prop="brand">
										</el-table-column>
										<el-table-column label="状态" prop="state">
										</el-table-column>
										<el-table-column label="操作" width="300px">
											<template slot-scope="temp">
												<el-button icon="el-icon-edit" size="mini" type="primary" @click="jie(temp.row.legworkid)">接车</el-button>
												<el-button icon="el-icon-edit" size="mini" type="primary" @click="showView(temp.row.legworkid)">编辑</el-button>
												<el-button icon="el-icon-delete" size="mini" type="danger" @click="delInfo(temp.row.legworkid)">删除</el-button>
											</template>
										</el-table-column>
									</el-table>
								</template>
								<div style="text-align:right;padding-right: 200px;">
									<el-button size="mini" @click="handleCurrentChange(1)">第一页</el-button>
									<el-button size="mini" v-if="page.hasPreviousPage" @click="handleCurrentChange(page.prePage)">上一页</el-button>
									<el-button size="mini" v-if="page.hasNextPage" @click="handleCurrentChange(page.nextPage)">下一页</el-button>
									<el-button size="mini" @click="handleCurrentChange(page.pages)">最后页</el-button>
									<span>第{{page.pageNum}}页/共{{page.pages}}页</span>
								</div>
							</el-tab-pane>
							<el-tab-pane label="已出车" name="已出车">
								<div class="layui-card-header">
									<button class="layui-btn" onclick="xadmin.open('添加外勤车辆','外勤车辆管理添加.html',800,600)">
                                <i class="layui-icon"></i>添加</button></div>
								<template>
									<el-table :data="this.page.list" style="width: 100%">
										<el-table-column label="车辆编号" prop="legworkid">
										</el-table-column>
										<el-table-column label="车牌号" prop="platenumber">
										</el-table-column>
										<el-table-column label="品牌" prop="brand">
										</el-table-column>
										<el-table-column label="状态" prop="state">
										</el-table-column>
										<el-table-column label="操作" width="300px">
											<template slot-scope="temp">
												<el-button icon="el-icon-edit" size="mini" type="primary" @click="hai(temp.row.legworkid)">完成接车</el-button>
												<el-button icon="el-icon-edit" size="mini" type="primary" @click="showView(temp.row.legworkid)">编辑</el-button>
												<el-button icon="el-icon-delete" size="mini" type="danger" @click="delInfo(temp.row.legworkid)">删除</el-button>
											</template>
										</el-table-column>
									</el-table>
								</template>
								<div style="text-align:right;padding-right: 200px;">
									<el-button size="mini" @click="handleCurrentChange(1)">第一页</el-button>
									<el-button size="mini" v-if="page.hasPreviousPage" @click="handleCurrentChange(page.prePage)">上一页</el-button>
									<el-button size="mini" v-if="page.hasNextPage" @click="handleCurrentChange(page.nextPage)">下一页</el-button>
									<el-button size="mini" @click="handleCurrentChange(page.pages)">最后页</el-button>
									<span>第{{page.pageNum}}页/共{{page.pages}}页</span>
								</div>

							</el-tab-pane>
							<el-tab-pane label="维修中" name="维修中">
								<div class="layui-card-header">
									<button class="layui-btn" onclick="xadmin.open('添加外勤车辆','外勤车辆管理添加.html',800,600)">
                                <i class="layui-icon"></i>添加</button></div>
								<template>
									<el-table :data="this.page.list" style="width: 100%">
										<el-table-column label="车辆编号" prop="legworkid">
										</el-table-column>
										<el-table-column label="车牌号" prop="platenumber">
										</el-table-column>
										<el-table-column label="品牌" prop="brand">
										</el-table-column>
										<el-table-column label="状态" prop="state">
										</el-table-column>
										<el-table-column label="操作">
											<template slot-scope="temp">
												<el-button icon="el-icon-edit" size="mini" type="primary" @click="showView(temp.row.legworkid)">编辑</el-button>
												<el-button icon="el-icon-delete" size="mini" type="danger" @click="delInfo(temp.row.legworkid)">删除</el-button>
											</template>
										</el-table-column>
									</el-table>
								</template>
								<div style="text-align:right;padding-right: 200px;">
									<el-button size="mini" @click="handleCurrentChange(1)">第一页</el-button>
									<el-button size="mini" v-if="page.hasPreviousPage" @click="handleCurrentChange(page.prePage)">上一页</el-button>
									<el-button size="mini" v-if="page.hasNextPage" @click="handleCurrentChange(page.nextPage)">下一页</el-button>
									<el-button size="mini" @click="handleCurrentChange(page.pages)">最后页</el-button>
									<span>第{{page.pageNum}}页/共{{page.pages}}页</span>
								</div>

							</el-tab-pane>
						</el-tabs>
					</template>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../js/index.js"></script>
	<script type="text/javascript" src="../js/bootstrap.min.js"></script>
	<script>
		var personApp = new Vue({
			el: '#legworkApp',
			data: {
				page: [],
				activeName:'未出车',
				bill:{
				legworkid:'',
				state:'',
				},
			},

			methods: {
				//查询外勤车辆信息
				query(pageNum, state) {
					let _this = this;
					$.getJSON(`http://localhost:8080/ljn/api/ljnlegworkAction/query/${pageNum}/${state}`, function(res) {
						_this.page = res;
					});
				},
				//根据状态切换外勤车辆信息
				handleClick(tab, event) {
					let _this = this;
					console.log(tab, event);
					_this.query(1,_this.activeName)
				},
				//删除外勤车辆信息
				delInfo(legworkid){
					let _this = this;
					if(confirm("是否删除")){
						$.getJSON(`http://localhost:8080/ljn/api/ljnlegworkAction/delete/${legworkid}`, function(res) {
						if(res>0){
							alert("删除成功")
						_this.query(1,_this.activeName)
						}
					});
					}
				},
				//翻页实现
				handleCurrentChange(pageNum){
					let _this = this;
					_this.query(pageNum,_this.activeName)
				},
				//查询指定外勤车辆信息
				showView(legworkid){
					$.getJSON(`http://localhost:8080/ljn/api/ljnlegworkAction/queryid/${legworkid}`, function(res) {
					window.sessionStorage.setItem('legwork', JSON.stringify(res));
					xadmin.open('外勤车辆管理修改','外勤车辆管理修改.html',800,600)
				})
				},
				//前去接车
				jie(legworkid){
				$.getJSON(`http://localhost:8080/ljn/api/ljnlegworkAction/queryid/${legworkid}`, function(res) {
					window.sessionStorage.setItem('jie', JSON.stringify(res));
					xadmin.open('外勤车辆接车','外勤车辆接车.html',800,600)
				})
				},
				//完成接车任务
				hai(legworkid){
					let _this = this;
					if(confirm("是否确定接车成功")){
					_this.bill.legworkid=legworkid;
					_this.bill.state="未出车",
						$.ajax({
							type: "POST",
							contentType: "application/json",
							data: JSON.stringify(_this.bill),
							url: `http://127.0.0.1:8080/ljn/api/ljnlegworkAction/update`,
							success: function(res) {
								if(res != 0) {
									alert("还车成功");
									xadmin.close();
									legworkApp.query(1, "未出车");
								}
							}
						});			
					}
				}
			},
			mounted() {
				let _this = this;
				_this.query(1,"未出车");
			},
		})
	</script>

</html>