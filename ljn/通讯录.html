<!DOCTYPE html>
<html class="x-admin-sm">

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<title>欢迎页面-X-admin2.2</title>
		<link rel="stylesheet" href="../css/index.css" />
		<script type="text/javascript" src="../js/vue.js"></script>
		<script type="text/javascript" src="../js/jquery-1.12.4.js"></script>
		<script type="text/javascript" src="../js/jq_ajax_config.js"></script>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="stylesheet" href="../css/font.css">
		<link rel="stylesheet" href="../css/xadmin.css">
		<script src="../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../js/xadmin.js"></script>
	</head>

	<body>
		<div class="x-nav">
			<span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
			</a>
		</div>
		<div class="layui-fluid" id="personApp">
			<div class="layui-row layui-col-space15">
				<div class="layui-col-md12">
					<div class="layui-card">
						<div class="layui-card-body " style="text-align: center;">
							<div class="layui-input-inline layui-show-xs-block">
								<input type="text" v-model="pname" name="username" placeholder="请输入员工姓名" autocomplete="off" class="layui-input"></div>
							<div class="layui-input-inline layui-show-xs-block">
								<button class="layui-btn" @click="queryid(pname)">
                                        <i class="layui-icon">&#xe615;</i></button>
							</div>
						</div>
						<div class="layui-card-header">
							<button class="layui-btn" onclick="xadmin.open('添加用户','通讯录添加.html',800,600)">
                                <i class="layui-icon"></i>添加</button></div>
						<template>
							<el-table :data="this.page.list" style="width: 100%">
								<el-table-column type="expand">
									<template slot-scope="props">
										<el-form label-position="left" inline class="demo-table-expand">
											<el-form-item label="员工名称">
												<span>{{ props.row.pname }}</span>
											</el-form-item>
											<el-form-item label="性别">
												<span>{{ props.row.psex }}</span>
											</el-form-item>
											<el-form-item label="员工地址">
												<span>{{ props.row.paddress }}</span>
											</el-form-item>
											<el-form-item label="员工身份证">
												<span>{{ props.row.pidcard }}</span>
											</el-form-item>
											<el-form-item label="员工入职日期">
												<span>{{ props.row.pentry }}</span>
											</el-form-item>
											<el-form-item label="员工岗位">
												<span>{{ props.row.ppost }}</span>
											</el-form-item>
											<el-form-item label="员工学历">
												<span>{{ props.row.peducational }}</span>
											</el-form-item>
										</el-form>
									</template>
								</el-table-column>
								<el-table-column label="通讯编号" prop="txlid">
								</el-table-column>
								<el-table-column label="通讯编号" prop="pid">
								</el-table-column>
								<el-table-column label="名称" prop="txlname">
								</el-table-column>
								<el-table-column label="联系号码" prop="txlphone">
								</el-table-column>
								<el-table-column label="操作">
									<template slot-scope="temp">
										<el-button icon="el-icon-edit" size="mini" type="primary" @click="showView(temp.row.txlid)">编辑</el-button>
										<el-button icon="el-icon-delete" size="mini" type="danger" @click="delInfo(temp.row.txlid)">删除</el-button>
									</template>
								</el-table-column>
							</el-table>
						</template>
						<div style="text-align:right;padding-right: 200px;">
							<el-button size="mini" @click="handleCurrentChange(1)">第一页</el-button>
							<el-button size="mini" v-if="page.hasPreviousPage" @click="handleCurrentChange(page.prePage)">上一页</el-button>
							<el-button size="mini" v-if="page.hasNextPage" @click="handleCurrentChange(page.nextPage)">下一页</el-button>
							<el-button size="mini" @click="handleCurrentChange(page.pages)">最后页</el-button>
							<span>第{{page.pageNum}}页/共{{page.pages}}页</span>
						</div>

					</div>

				</div>
			</div>
		</div>
		</div>
	</body>
	<script type="text/javascript" src="../js/index.js"></script>
	<script type="text/javascript" src="../js/bootstrap.min.js"></script>
	<script>
		var personApp = new Vue({
			el: '#personApp',
			data: {
				page: [],
				pname: "",
			},
			methods: {
				//查询根据条件分页查询通讯录信息
				query(pageNum, pname) {
					let _this = this;
					$.getJSON(`http://localhost:8080/ljn/api/ljnUserphoneAction/query/${pageNum}/${pname}`, function(res) {
						_this.page = res;
					});
				},
				//翻页实现
				handleCurrentChange(page) {
					let _this = this;
					_this.query(page, "null");
				},
				//根据姓名查询通讯录信息
				queryid(pname) {
					let _this = this;
					_this.query(1, pname);
				},
				//根据编号删除通讯录信息
				delInfo(id){
					let _this = this;
					if(confirm("是否删除")){
					$.getJSON(`http://localhost:8080/ljn/api/ljnUserphoneAction/remove/${id}`, function(res) {
						if(res>0){
							alert("删除成功")
							_this.query(1, "null");
						}
					});
					}
				},
				//查询需要编辑的通讯录信息
				showView(txlid){
					$.getJSON(`http://localhost:8080/ljn/api/ljnUserphoneAction/queryid/${txlid}`, function(res) {
					window.sessionStorage.setItem('us', JSON.stringify(res));
					xadmin.open('修改用户','通讯录修改.html',800,600);
				})
				},
			},
			mounted() {
				let _this = this;
				_this.query(1, "null");
			},
		})
	</script>

</html>